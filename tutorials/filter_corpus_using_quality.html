<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<meta property="og:title" content="Filtering corpora using Quality" />
<meta property="og:type" content="website" />
<meta property="og:url" content="tutorials/filter_corpus_using_quality.html" />
<meta property="og:site_name" content="textdescriptives" />
<meta property="og:description" content="In many cases if you want to analyse tweets, train a model on text scraped from the web or similar, it is important to filter out low-quality texts. TextDescriptives implements a series of heuristi..." />
<meta name="description" content="In many cases if you want to analyse tweets, train a model on text scraped from the web or similar, it is important to filter out low-quality texts. TextDescriptives implements a series of heuristi..." />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="News and Changelog" href="../news.html" /><link rel="prev" title="Introductory Tutorial" href="introductory_tutorial.html" />

    <!-- Generated with Sphinx 6.1.3 and Furo 2022.12.07 -->
        <title>Filtering corpora using Quality - textdescriptives 2.2.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?digest=91d0f0d1c444bdcb17a68e833c7a53903343c195" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/autodoc_pydantic.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  --color-brand-primary: #ff5454;
  --color-brand-content: #ff7575;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-brand-primary: #ff8f8f;
  --color-brand-content: #ff8f8f;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-brand-primary: #ff8f8f;
  --color-brand-content: #ff8f8f;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">textdescriptives 2.2.0 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="../_static/icon.png" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="../_static/icon_dark.png" alt="Dark Logo"/>
  </div>
  
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usingthepackage.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usingthepackage.html#using-specific-components">Using Specific Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usingthepackage.html#available-attributes">Available Attributes</a></li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="../tutorial.html">Tutorials</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="introductory_tutorial.html">Introductory Tutorial</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Filtering corpora using Quality</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../news.html">News and Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">Frequently Asked Questions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Components</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../descriptivestats.html">Descriptive Statistics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../readability.html">Readability</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dependencydistance.html">Dependency Distance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../posstats.html">Part-of-Speech Proportions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quality.html">Quality</a></li>
<li class="toctree-l1"><a class="reference internal" href="../coherence.html">Coherence</a></li>
<li class="toctree-l1"><a class="reference internal" href="../extractors.html">Extractor</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/hlasse/TextDescriptives">GitHub Repository</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="filtering-corpora-using-quality">
<h1>Filtering corpora using Quality<a class="headerlink" href="#filtering-corpora-using-quality" title="Permalink to this heading">#</a></h1>
<a target="_blank" href="https://colab.research.google.com/github/HLasse/TextDescriptives/blob/main/docs/tutorials/filter_corpus_using_quality.ipynb">
  <img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"/>
</a>
<p>In many cases if you want to analyse tweets, train a model on text scraped from the web or similar, it is important to filter out low-quality texts.</p>
<p>TextDescriptives implements a series of heuristic filters for removing low-quality text. This tutorial will take you through how to use these to filter
your text corpora.</p>
<section id="setup">
<h2>Setup<a class="headerlink" href="#setup" title="Permalink to this heading">#</a></h2>
<p>For this we will use datasets available on <a class="reference external" href="https://huggingface.co/datasets">Huggingface Datasets</a>. Thus we will need the <code class="docutils literal notranslate"><span class="pre">datasets</span></code> package. Which you can install by running</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!pip install datasets
</pre></div>
</div>
<p>Or by installing textdescriptives with the <code class="docutils literal notranslate"><span class="pre">[tutorials]</span></code> option as below</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">textdescriptives</span> <span class="k">as</span> <span class="nn">td</span>
<span class="k">except</span><span class="p">:</span>
    <span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span><span class="s2">&quot;textdescriptives[tutorials]&quot;</span>
    <span class="kn">import</span> <span class="nn">textdescriptives</span> <span class="k">as</span> <span class="nn">td</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="filtering-web-content">
<h2>Filtering Web content<a class="headerlink" href="#filtering-web-content" title="Permalink to this heading">#</a></h2>
<section id="the-data">
<h3>The Data<a class="headerlink" href="#the-data" title="Permalink to this heading">#</a></h3>
<p>For our first example we will filter web content. For this we will use the <a class="reference external" href="https://huggingface.co/datasets/mc4">mC4 dataset</a>. It would take ages to download the whole data so instead we will stream down 1000 samples from the dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datasets</span> <span class="kn">import</span> <span class="n">load_dataset</span>

<span class="c1"># stream in the dataset</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">load_dataset</span><span class="p">(</span><span class="s2">&quot;mc4&quot;</span><span class="p">,</span> <span class="s2">&quot;en&quot;</span><span class="p">,</span> <span class="n">streaming</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">split</span> <span class="o">=</span> <span class="s2">&quot;train&quot;</span><span class="p">)</span>

<span class="c1"># download the first 1 000</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>

<span class="c1"># extract the text</span>
<span class="n">texts</span> <span class="o">=</span> <span class="p">[</span><span class="n">sample</span> <span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="n">dataset</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "b4a47a4750014ee08369742b21ad407e"}</script><script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "c2d04c2e14e5415ba8d0b1402d5091d2"}</script></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># let us look at the first part (400 characters) of the first text</span>
<span class="nb">print</span><span class="p">(</span><span class="n">texts</span><span class="p">[</span><span class="mi">0</span><span class="p">][:</span><span class="mi">400</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Posts 4,362	More Info
Okay so to those of you that were very helpful this is not to you but for those of you that laugh when I ask about ohms or powering LSi15&#39;s this is to you. If you know a book, website, or someone to talk to to get more info that I seek so I know what some of you are talking about please share it with me. I ask questions to gain more info on audio thats all. Not to get laughed
</pre></div>
</div>
</div>
</div>
</section>
<section id="filtering">
<h3>Filtering<a class="headerlink" href="#filtering" title="Permalink to this heading">#</a></h3>
<p>To filter texts using <code class="docutils literal notranslate"><span class="pre">textdescriptives</span></code> we need to first set up the pipeline:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">spacy</span>

<span class="c1"># create the spacy nlp pipeline</span>
<span class="n">nlp</span> <span class="o">=</span> <span class="n">spacy</span><span class="o">.</span><span class="n">blank</span><span class="p">(</span><span class="s2">&quot;en&quot;</span><span class="p">)</span>
<span class="c1"># add a component for sentence segmentation</span>
<span class="n">nlp</span><span class="o">.</span><span class="n">add_pipe</span><span class="p">(</span><span class="s2">&quot;sentencizer&quot;</span><span class="p">)</span>
<span class="c1"># add a component for quality filtering</span>
<span class="n">quality_pipe</span> <span class="o">=</span> <span class="n">nlp</span><span class="o">.</span><span class="n">add_pipe</span><span class="p">(</span><span class="s2">&quot;textdescriptives/quality&quot;</span><span class="p">)</span>

<span class="c1"># apply the pipeline to the texts</span>
<span class="n">docs</span> <span class="o">=</span> <span class="n">nlp</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">texts</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>You will note here that docs is a generator. This can be quite useful (especially when streaming texts in one at a time), but for this example we can simply convert it to a list:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;docs is type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">docs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;docs is type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>docs is type &lt;class &#39;generator&#39;&gt;
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyboardInterrupt</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;docs is type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">docs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;docs is type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nn">File ~/.local/lib/python3.10/site-packages/spacy/language.py:1589,</span> in <span class="ni">Language.pipe</span><span class="nt">(self, texts, as_tuples, batch_size, disable, component_cfg, n_process)</span>
<span class="g g-Whitespace">   </span><span class="mi">1587</span>     <span class="k">for</span> <span class="n">pipe</span> <span class="ow">in</span> <span class="n">pipes</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1588</span>         <span class="n">docs</span> <span class="o">=</span> <span class="n">pipe</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">1589</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">docs</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1590</span>     <span class="k">yield</span> <span class="n">doc</span>

<span class="nn">File ~/.local/lib/python3.10/site-packages/spacy/util.py:1663,</span> in <span class="ni">_pipe</span><span class="nt">(docs, proc, name, default_error_handler, kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">1661</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">docs</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1662</span>     <span class="k">try</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">1663</span>         <span class="n">doc</span> <span class="o">=</span> <span class="n">proc</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># type: ignore[call-arg]</span>
<span class="g g-Whitespace">   </span><span class="mi">1664</span>         <span class="k">yield</span> <span class="n">doc</span>
<span class="g g-Whitespace">   </span><span class="mi">1665</span>     <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

<span class="nn">File ~/.local/lib/python3.10/site-packages/textdescriptives/components/quality.py:530,</span> in <span class="ni">Quality.__call__</span><span class="nt">(self, doc)</span>
<span class="g g-Whitespace">    </span><span class="mi">528</span> <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">:</span> <span class="n">Doc</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">529</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;Run the pipeline component.&quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">530</span>     <span class="bp">self</span><span class="o">.</span><span class="n">set_quality</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">531</span>     <span class="k">return</span> <span class="n">doc</span>

<span class="nn">File ~/.local/lib/python3.10/site-packages/textdescriptives/components/quality.py:480,</span> in <span class="ni">Quality.set_quality</span><span class="nt">(self, doc)</span>
<span class="g g-Whitespace">    </span><span class="mi">472</span><span class="w"> </span><span class="sd">&quot;&quot;&quot;Set the quality attribute on a doc.</span>
<span class="g g-Whitespace">    </span><span class="mi">473</span><span class="sd"> </span>
<span class="g g-Whitespace">    </span><span class="mi">474</span><span class="sd"> Args:</span>
<span class="g g-Whitespace">    </span><span class="mi">475</span><span class="sd">     doc (Doc): spaCy doc object</span>
<span class="g g-Whitespace">    </span><span class="mi">476</span><span class="sd"> &quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">477</span> <span class="c1"># to allow the variable to json serializable we convert it to json</span>
<span class="g g-Whitespace">    </span><span class="mi">478</span> <span class="c1"># it is then converted back into a quality output object in the getter</span>
<span class="ne">--&gt; </span><span class="mi">480</span> <span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">_quality</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">quality_setter</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span><span class="o">.</span><span class="n">dict</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">481</span> <span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">passed_quality_check</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">passed_quality_thresholds</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>

<span class="nn">File ~/.local/lib/python3.10/site-packages/textdescriptives/components/quality.py:424,</span> in <span class="ni">Quality.quality_setter</span><span class="nt">(self, span)</span>
<span class="g g-Whitespace">    </span><span class="mi">409</span> <span class="n">thresholds_outputs</span><span class="p">[</span><span class="s2">&quot;contains&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
<span class="g g-Whitespace">    </span><span class="mi">410</span>     <span class="n">string</span><span class="p">:</span> <span class="n">ThresholdsOutput</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">411</span>         <span class="n">value</span><span class="o">=</span><span class="n">contains_string</span><span class="p">(</span><span class="n">span</span><span class="p">,</span> <span class="n">string</span><span class="p">),</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">414</span>     <span class="k">for</span> <span class="n">string</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">contains</span>
<span class="g g-Whitespace">    </span><span class="mi">415</span> <span class="p">}</span>
<span class="g g-Whitespace">    </span><span class="mi">416</span> <span class="n">thresholds_outputs</span><span class="p">[</span><span class="s2">&quot;symbol_to_word_ratio&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
<span class="g g-Whitespace">    </span><span class="mi">417</span>     <span class="n">symbol</span><span class="p">:</span> <span class="n">ThresholdsOutput</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">418</span>         <span class="n">value</span><span class="o">=</span><span class="n">symbol_to_word_ratio</span><span class="p">(</span><span class="n">span</span><span class="p">,</span> <span class="n">symbol</span><span class="p">),</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">421</span>     <span class="k">for</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span>
<span class="g g-Whitespace">    </span><span class="mi">422</span> <span class="p">}</span>
<span class="ne">--&gt; </span><span class="mi">424</span> <span class="n">chr_frac</span> <span class="o">=</span> <span class="n">top_ngram_chr_fraction</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">425</span>     <span class="n">span</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">426</span>     <span class="n">ngram_range</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">top_ngram_range</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">427</span>     <span class="n">min_count</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">top_ngram_min_count</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">428</span> <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">430</span> <span class="n">thresholds_outputs</span><span class="p">[</span><span class="s2">&quot;top_ngram_chr_fraction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
<span class="g g-Whitespace">    </span><span class="mi">431</span>     <span class="nb">str</span><span class="p">(</span><span class="n">n_gram</span><span class="p">):</span> <span class="n">ThresholdsOutput</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">432</span>         <span class="n">value</span><span class="o">=</span><span class="n">frac</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="nn">    438     for n_gram, frac</span> in <span class="ni">chr_frac.items</span><span class="nt">()</span>
<span class="g g-Whitespace">    </span><span class="mi">439</span> <span class="p">}</span>
<span class="g g-Whitespace">    </span><span class="mi">441</span> <span class="n">duplicate_ngram_chr_fraction</span> <span class="o">=</span> <span class="n">duplicate_ngram_fraction</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">442</span>     <span class="n">span</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">443</span>     <span class="n">ngram_range</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">duplicate_n_gram_fraction_range</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">444</span> <span class="p">)</span>

<span class="nn">File ~/.local/lib/python3.10/site-packages/textdescriptives/components/quality.py:303,</span> in <span class="ni">top_ngram_chr_fraction</span><span class="nt">(span, ngram_range, min_count)</span>
<span class="g g-Whitespace">    </span><span class="mi">300</span> <span class="k">if</span> <span class="n">chr_len</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">301</span>     <span class="k">return</span> <span class="p">{</span><span class="n">n</span><span class="p">:</span> <span class="mf">0.0</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ngram_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ngram_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)}</span>
<span class="ne">--&gt; </span><span class="mi">303</span> <span class="n">ngram_counter</span> <span class="o">=</span> <span class="n">span_ngrams</span><span class="p">(</span><span class="n">span</span><span class="p">,</span> <span class="n">ngram_range</span><span class="o">=</span><span class="n">ngram_range</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">304</span> <span class="n">top_ngram_chr_frac</span> <span class="o">=</span> <span class="p">{}</span>
<span class="g g-Whitespace">    </span><span class="mi">305</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">ngram_counter</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">306</span>     <span class="c1"># find the top n-gram</span>

<span class="nn">File ~/.local/lib/python3.10/site-packages/textdescriptives/components/quality.py:233,</span> in <span class="ni">span_ngrams</span><span class="nt">(span, ngram_range)</span>
<span class="g g-Whitespace">    </span><span class="mi">231</span>             <span class="n">ngram</span> <span class="o">=</span> <span class="n">ngram_span</span><span class="o">.</span><span class="n">text</span>
<span class="g g-Whitespace">    </span><span class="mi">232</span>             <span class="n">shingles_count</span><span class="p">[</span><span class="n">ngram_size</span><span class="p">][</span><span class="n">ngram</span><span class="p">][</span><span class="s2">&quot;count&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># type: ignore</span>
<span class="ne">--&gt; </span><span class="mi">233</span>             <span class="n">shingles_count</span><span class="p">[</span><span class="n">ngram_size</span><span class="p">][</span><span class="n">ngram</span><span class="p">][</span><span class="s2">&quot;span&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
<span class="g g-Whitespace">    </span><span class="mi">234</span>                 <span class="n">ngram_span</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">235</span>             <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">236</span> <span class="k">return</span> <span class="n">shingles_count</span>

<span class="ne">KeyboardInterrupt</span>: 
</pre></div>
</div>
</div>
</div>
<p>Now it is easy to examine the documents using the <code class="docutils literal notranslate"><span class="pre">doc._.quality</span></code> or <code class="docutils literal notranslate"><span class="pre">doc._.passed_quality_check</span></code> extensions:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># examine the first document</span>
<span class="n">doc</span> <span class="o">=</span> <span class="n">docs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">doc</span><span class="p">[:</span><span class="mi">100</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Posts 4,362	More Info
Okay so to those of you that were very helpful this is not to you but for those of you that laugh when I ask about ohms or powering LSi15&#39;s this is to you. If you know a book, website, or someone to talk to to get more info that I seek so I know what some of you are talking about please share it with me. I ask questions to gain more info on audio thats all. Not to get laughed at when asking it.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">passed_quality_check</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>False
</pre></div>
</div>
</div>
</div>
<p>It seems like this document did no pass the quality check. Let us examine why that is:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">quality</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>QualityOutput(
	passed=False, 
	n_stop_words=ThresholdsOutput(value=435.0, passed=True, threshold=(2.0, None)), 
	alpha_ratio=ThresholdsOutput(value=0.79, passed=True, threshold=(0.7, None)), 
	mean_word_length=ThresholdsOutput(value=3.52, passed=True, threshold=(3.0, 10.0)), 
	doc_length=ThresholdsOutput(value=894.0, passed=True, threshold=(10.0, 100000.0)), 
	symbol_to_word_ratio={&#39;#&#39;: ThresholdsOutput(value=0.0, passed=True, threshold=(None, 0.1))}, 
	proportion_ellipsis=ThresholdsOutput(value=0.0, passed=True, threshold=(None, 0.3)), 
	proportion_bullet_points=ThresholdsOutput(value=0.0, passed=True, threshold=(None, 0.8)), 
	contains={&#39;lorem ipsum&#39;: ThresholdsOutput(value=0.0, passed=True, threshold=False)}, 
	duplicate_line_chr_fraction=ThresholdsOutput(value=0.0, passed=True, threshold=(None, 0.2)), 
	duplicate_paragraph_chr_fraction=ThresholdsOutput(value=0.0, passed=True, threshold=(None, 0.2)), 
	duplicate_ngram_chr_fraction={&#39;5&#39;: ThresholdsOutput(value=0.42, passed=False, threshold=(None, 0.15)), &#39;6&#39;: ThresholdsOutput(value=0.42, passed=False, threshold=(None, 0.14)), &#39;7&#39;: ThresholdsOutput(value=0.38, passed=False, threshold=(None, 0.13)), &#39;8&#39;: ThresholdsOutput(value=0.36, passed=False, threshold=(None, 0.12)), &#39;9&#39;: ThresholdsOutput(value=0.36, passed=False, threshold=(None, 0.11)), &#39;10&#39;: ThresholdsOutput(value=0.36, passed=False, threshold=(None, 0.1))}, 
	top_ngram_chr_fraction={&#39;2&#39;: ThresholdsOutput(value=0.01, passed=True, threshold=(None, 0.2)), &#39;3&#39;: ThresholdsOutput(value=0.01, passed=True, threshold=(None, 0.18)), &#39;4&#39;: ThresholdsOutput(value=0.01, passed=True, threshold=(None, 0.16))})
</pre></div>
</div>
</div>
</div>
<p>Naturally, you might not know what all of these mean, but you can easily check it on <a class="reference external" href="https://hlasse.github.io/TextDescriptives/quality.html">the documentation site</a>. Examining these we see that this text has a high proportion of characters which appear in duplicate n-grams <code class="docutils literal notranslate"><span class="pre">duplicate_10-gram_chr_fraction</span></code>. When this fraction is really high it means that the text contains a high proportion of repititions. This is often a sign of low quality text.</p>
<p>If we examine the quality thresholds of the pipeline we can see that the max allowed value for <code class="docutils literal notranslate"><span class="pre">duplicate_10-gram_chr_fraction</span></code> is 0.1:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">quality_pipe</span><span class="o">.</span><span class="n">quality_thresholds</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;---&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The thresholds for Duplicate n-grams:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">quality_pipe</span><span class="o">.</span><span class="n">quality_thresholds</span><span class="o">.</span><span class="n">duplicate_ngram_chr_fraction</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>n_stop_words=(2, None) alpha_ratio=(0.7, None) mean_word_length=(3, 10) doc_length=(10, 100000) symbol_to_word_ratio={&#39;#&#39;: (None, 0.1)} proportion_ellipsis=(None, 0.3) proportion_bullet_points=(None, 0.8) contains={&#39;lorem ipsum&#39;: False} duplicate_line_chr_fraction=(None, 0.2) duplicate_paragraph_chr_fraction=(None, 0.2) duplicate_ngram_chr_fraction={&#39;5&#39;: (None, 0.15), &#39;6&#39;: (None, 0.14), &#39;7&#39;: (None, 0.13), &#39;8&#39;: (None, 0.12), &#39;9&#39;: (None, 0.11), &#39;10&#39;: (None, 0.1)} top_ngram_chr_fraction={&#39;2&#39;: (None, 0.2), &#39;3&#39;: (None, 0.18), &#39;4&#39;: (None, 0.16)}
---
The thresholds for Duplicate n-grams:
{&#39;5&#39;: (None, 0.15), &#39;6&#39;: (None, 0.14), &#39;7&#39;: (None, 0.13), &#39;8&#39;: (None, 0.12), &#39;9&#39;: (None, 0.11), &#39;10&#39;: (None, 0.1)}
</pre></div>
</div>
</div>
</div>
</section>
<section id="extracting-high-quality-texts">
<h3>Extracting high quality texts<a class="headerlink" href="#extracting-high-quality-texts" title="Permalink to this heading">#</a></h3>
<p>We are typically interested in text which are not of low quality. We can extract these by filtering out the texts which did not pass the quality check.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">filtered_texts</span> <span class="o">=</span> <span class="p">[</span><span class="n">doc</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">docs</span> <span class="k">if</span> <span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">passed_quality_check</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;A total of </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span><span class="si">}</span><span class="s2"> texts were processed and </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">filtered_texts</span><span class="p">)</span><span class="si">}</span><span class="s2"> passed the quality check.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>A total of 1000 texts were processed and 572 passed the quality check.
</pre></div>
</div>
</div>
</div>
</section>
<section id="changing-the-filters">
<h3>Changing the filters<a class="headerlink" href="#changing-the-filters" title="Permalink to this heading">#</a></h3>
<p>In some cases you might want to apply other filters. For instance the current filter sets a <code class="docutils literal notranslate"><span class="pre">symbol_to_word_ratio</span></code> threshold of 0.1 for hashtags <code class="docutils literal notranslate"><span class="pre">#</span></code>. This means that if a text contains a lot of hashtags it will be filtered out. However if you are working on e.g. tweets this is an unreasonable filter and you might want to adjust that. You can do this by overwriting the quality_thresholds:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">new_thresholds</span> <span class="o">=</span> <span class="n">td</span><span class="o">.</span><span class="n">QualityThresholds</span><span class="p">(</span>
    <span class="n">n_stop_words</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="c1"># at least 2 stop words, no upper bound</span>
    <span class="n">alpha_ratio</span><span class="o">=</span> <span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
    <span class="n">mean_word_length</span><span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="c1"># mean word length between 3 and 10 characters</span>
    <span class="n">doc_length</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">100_000</span><span class="p">),</span>
    <span class="n">symbol_to_word_ratio</span> <span class="o">=</span> <span class="p">{},</span> <span class="c1"># don&#39;t filter based on symbol to word ratio.</span>
    <span class="n">proportion_ellipsis</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">),</span>
    <span class="n">proportion_bullet_points</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">),</span>
    <span class="n">contains</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;lorem ipsum&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span> <span class="c1"># remove texts which contain the string &quot;lorem ipsum&quot;</span>
    <span class="n">duplicate_line_chr_fraction</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span>
    <span class="n">duplicate_paragraph_chr_fraction</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span>
    <span class="n">duplicate_ngram_chr_fraction</span> <span class="o">=</span> <span class="p">{},</span> <span class="c1"># don&#39;t filter based on duplicate n-grams</span>
    <span class="n">top_ngram_chr_fraction</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;2&quot;</span><span class="p">:</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span> <span class="s2">&quot;3&quot;</span><span class="p">:</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mf">0.18</span><span class="p">),</span> <span class="s2">&quot;4&quot;</span><span class="p">:</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mf">0.16</span><span class="p">)}</span>
<span class="p">)</span>

<span class="c1"># overwrite the existing thresholds</span>
<span class="n">quality_pipe</span><span class="o">.</span><span class="n">set_quality_thresholds</span><span class="p">(</span><span class="n">new_thresholds</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>If you want to read more about what each argument does, please check out the <a class="reference external" href="https://hlasse.github.io/TextDescriptives/quality.html#data-classes">documentation</a>.
All the <code class="docutils literal notranslate"><span class="pre">passed</span></code> values and <code class="docutils literal notranslate"><span class="pre">passed_quality_check</span></code> attributes are dynamically updated when you can <code class="docutils literal notranslate"><span class="pre">.set_quality_thresholds</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># check if the new text now pass the quality filter</span>
<span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">passed_quality_check</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>False
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="comparing-domains">
<h2>Comparing Domains<a class="headerlink" href="#comparing-domains" title="Permalink to this heading">#</a></h2>
<p>These quality metrics are heuristic based and need to be tuned. While the defaults are reasonable for some domains, they may not be for others. We will explore this a bit further in this section. These filters are specifically tuned for the web domain and this can lead to problems when applied directly to other domains.</p>
<section id="data">
<h3>Data<a class="headerlink" href="#data" title="Permalink to this heading">#</a></h3>
<p>For this we will use the <a class="reference external" href="https://sprogteknologi.dk/dataset/danish-gigaword">Danish Gigaword</a> available on <span class="xref myst">Huggingface Datasets</span>. For the purpose of this tutorial we will just use a small test version of it containing around 2500 examples, but you could easily change it to use the whole dataset. Danish Gigaword is a large collection of Danish texts collected from a variety of domains.</p>
<p>We can download the dataset using the following command:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datasets</span> <span class="kn">import</span> <span class="n">load_dataset</span>

<span class="c1"># note that this can take a little while</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">load_dataset</span><span class="p">(</span><span class="s2">&quot;DDSC/partial-danish-gigaword-small-test-sample&quot;</span><span class="p">)</span>

<span class="c1"># All of the dataset is available in the train split</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="s2">&quot;train&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Using custom data configuration DDSC--partial-danish-gigaword-small-test-sample-6518b630de09688d
Found cached dataset parquet (/Users/au561649/.cache/huggingface/datasets/DDSC___parquet/DDSC--partial-danish-gigaword-small-test-sample-6518b630de09688d/0.0.0/2a3b91fbd88a2c90d1dbbb32b460cf621d31bd5b05b934492fdef7d8d6f236ec)
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "2c78220f7f1e4c119901389899b11a7b", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We can take a look at one of the examples:</span>
<span class="n">ten_samples</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="n">ten_samples</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>text</th>
      <th>source</th>
      <th>doc_id</th>
      <th>LICENSE</th>
      <th>uri</th>
      <th>date_built</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Den fulde tekst Pressenævnets kendelse i sag n...</td>
      <td>retsinformationdk</td>
      <td>retsinformationdk_173889</td>
      <td>Danish Copyright law at https://www.retsinform...</td>
      <td>https://www.retsinformation.dk/Forms/R0710.asp...</td>
      <td>Fri Nov 22 00:51:31 2019 +0100</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Resume\n\nEfter at der var sket afskedigelser ...</td>
      <td>retsinformationdk</td>
      <td>retsinformationdk_39059</td>
      <td>Danish Copyright law at https://www.retsinform...</td>
      <td>https://www.retsinformation.dk/Forms/R0710.asp...</td>
      <td>Fri Nov 22 00:51:14 2019 +0100</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Resume\n\nContainere kunne ikke anses som genb...</td>
      <td>retsinformationdk</td>
      <td>retsinformationdk_15045</td>
      <td>Danish Copyright law at https://www.retsinform...</td>
      <td>https://www.retsinformation.dk/Forms/R0710.asp...</td>
      <td>Fri Nov 22 00:51:28 2019 +0100</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Resume\n\nEn forhandler ved »home-parties« af ...</td>
      <td>retsinformationdk</td>
      <td>retsinformationdk_37261</td>
      <td>Danish Copyright law at https://www.retsinform...</td>
      <td>https://www.retsinformation.dk/Forms/R0710.asp...</td>
      <td>Fri Nov 22 00:49:27 2019 +0100</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Den fulde tekst\n\nSkrivelse om lov om fleksyd...</td>
      <td>retsinformationdk</td>
      <td>retsinformationdk_19415</td>
      <td>Danish Copyright law at https://www.retsinform...</td>
      <td>https://www.retsinformation.dk/Forms/R0710.asp...</td>
      <td>Fri Nov 22 00:52:27 2019 +0100</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Resume\n\nResumé\n\nKlage over påbud om særlig...</td>
      <td>retsinformationdk</td>
      <td>retsinformationdk_31217</td>
      <td>Danish Copyright law at https://www.retsinform...</td>
      <td>https://www.retsinformation.dk/Forms/R0710.asp...</td>
      <td>Fri Nov 22 00:49:18 2019 +0100</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Resume\n\nResumé\n\nI en række af de af Danmar...</td>
      <td>retsinformationdk</td>
      <td>retsinformationdk_14387</td>
      <td>Danish Copyright law at https://www.retsinform...</td>
      <td>https://www.retsinformation.dk/Forms/R0710.asp...</td>
      <td>Fri Nov 22 00:49:49 2019 +0100</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Oversigt (indholdsfortegnelse)\n\nBilag 1\n\nD...</td>
      <td>retsinformationdk</td>
      <td>retsinformationdk_166197</td>
      <td>Danish Copyright law at https://www.retsinform...</td>
      <td>https://www.retsinformation.dk/Forms/R0710.asp...</td>
      <td>Fri Nov 22 00:49:44 2019 +0100</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Den fulde tekst\n\nBekendtgørelse om afregning...</td>
      <td>retsinformationdk</td>
      <td>retsinformationdk_76994</td>
      <td>Danish Copyright law at https://www.retsinform...</td>
      <td>https://www.retsinformation.dk/Forms/R0710.asp...</td>
      <td>Fri Nov 22 00:52:52 2019 +0100</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Den fulde tekst Ligebehandlingsnævnets afgørel...</td>
      <td>retsinformationdk</td>
      <td>retsinformationdk_192325</td>
      <td>Danish Copyright law at https://www.retsinform...</td>
      <td>https://www.retsinformation.dk/Forms/R0710.asp...</td>
      <td>Fri Nov 22 00:51:41 2019 +0100</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>As previously mentioned, the Danish Gigaword corpus consist of multiple domains. For this tutorial, we will look at three of these domains. <code class="docutils literal notranslate"><span class="pre">retsinformationdk</span></code> which consists of legal documents, <code class="docutils literal notranslate"><span class="pre">hest</span></code> which contains post from a Danish debate forum (<a class="reference external" href="https://www.heste-nettet.dk/">heste-nettet.dk</a>) and <code class="docutils literal notranslate"><span class="pre">spont</span></code> which contains texts transcribed from spontaneous speech.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># we can filter out these three datasets based on the &quot;source&quot;</span>
<span class="n">legal</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;retsinformationdk&quot;</span><span class="p">,</span> <span class="n">num_proc</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">news</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;tv2r&quot;</span><span class="p">,</span> <span class="n">num_proc</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">speech</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;spont&quot;</span><span class="p">,</span> <span class="n">num_proc</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "cf05115807f14affa8d479778d1c466a", "version_major": 2, "version_minor": 0}</script><script type="application/vnd.jupyter.widget-view+json">{"model_id": "b4e3b0d54e724294b184fc8389fa6a69", "version_major": 2, "version_minor": 0}</script><script type="application/vnd.jupyter.widget-view+json">{"model_id": "5e2b9e6a5a3243008c0972e66b54e426", "version_major": 2, "version_minor": 0}</script></div>
</div>
<p>We can now examine these datasets a bit more:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Legal contains </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">legal</span><span class="p">)</span><span class="si">}</span><span class="s2"> examples&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;News contains </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">news</span><span class="p">)</span><span class="si">}</span><span class="s2"> examples&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Speech contains </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">speech</span><span class="p">)</span><span class="si">}</span><span class="s2"> examples&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Legal contains 1000 examples
News contains 1000 examples
Speech contains 411 examples
</pre></div>
</div>
</div>
</div>
<p>We can for example see that the speech dataset contains notably fewer samples than the others.</p>
</section>
<section id="quality-filtering">
<h3>Quality Filtering<a class="headerlink" href="#quality-filtering" title="Permalink to this heading">#</a></h3>
<p>After we have prepared our datasets we can now start with the quality filtering. Using TextDescriptives, this is extremely simple. We need to do 3 things:</p>
<ol class="arabic simple">
<li><p>Create a pipeline</p></li>
<li><p>Add the quality component to it</p></li>
<li><p>Apply the pipeline to the dataset</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1. Crease a blank spaCy model with a sentencizer as that&#39;s the only component required for the quality metrics</span>
<span class="n">nlp</span> <span class="o">=</span> <span class="n">spacy</span><span class="o">.</span><span class="n">blank</span><span class="p">(</span><span class="s2">&quot;da&quot;</span><span class="p">)</span>
<span class="n">nlp</span><span class="o">.</span><span class="n">add_pipe</span><span class="p">(</span><span class="s2">&quot;sentencizer&quot;</span><span class="p">)</span>
<span class="n">nlp</span><span class="o">.</span><span class="n">max_length</span> <span class="o">=</span> <span class="mi">2000000</span>  <span class="c1"># as some of the documents are quite long we can increase the max length</span>
<span class="c1"># however it might be worth filtering out these documents beforehand for very very long documents.</span>

<span class="c1"># 2. Add the textdescriptives pipeline</span>
<span class="n">quality_pipe</span> <span class="o">=</span> <span class="n">nlp</span><span class="o">.</span><span class="n">add_pipe</span><span class="p">(</span><span class="s2">&quot;textdescriptives/quality&quot;</span><span class="p">)</span>

<span class="c1"># 3. Apply the pipeline to the legal documents</span>
<span class="n">legal_docs</span> <span class="o">=</span> <span class="n">nlp</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">legal</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>If we check now we can see that legal_docs is a generator. This can be a quite efficient format, but for now we just want to process all the text so we simply need to convert it to a list:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">legal_docs</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;generator object Language.pipe at 0x14b8320b0&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">legal_docs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">legal_docs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can now inspect the output here:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">legal_doc</span> <span class="o">=</span> <span class="n">legal_docs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">legal_doc</span><span class="p">[:</span><span class="mi">100</span><span class="p">])</span> <span class="c1"># print the first 100 tokens</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;----&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;This passed the quality filter:&quot;</span><span class="p">)</span>
<span class="n">legal_doc</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">passed_quality_check</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Den fulde tekst Pressenævnets kendelse i sag nr. 15-70-00822
Resumé
Foreningen for Skånsomt Kystfiskeri har ikke retlig interesse
DR bragte et radioindslag om Natur- og Erhvervsstyrelsens fiskeriinspektorats fangst af ulovlige ålefælder. Foreningen for Skånsomt Kystfiskeri klagede blandt andet med den begrundelse, at betegnelsen ” ålefælder ” er forkert, idet ålene selv kan svømme ind og ud. Pressenævnet afviser at behandle klagen, da foreningen ikke er omtalt i udsendelsen og derfor ikke har retlig interesse.
Pressenævnets formand udtaler:
Det er en betingelse for at klage til Pressenævnet, at
----
This passed the quality filter:
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>False
</pre></div>
</div>
</div>
</div>
<p>Here we see that the text did not pass the quality filter. We can now examine why that using the following code:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">legal_doc</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">quality</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>QualityOutput(passed=False, n_stop_words=ThresholdsOutput(value=192.0, passed=True, threshold=(2.0, None)), alpha_ratio=ThresholdsOutput(value=0.8, passed=True, threshold=(0.7, None)), mean_word_length=ThresholdsOutput(value=4.55, passed=True, threshold=(3.0, 10.0)), doc_length=ThresholdsOutput(value=500.0, passed=True, threshold=(10.0, 100000.0)), symbol_to_word_ratio={&#39;#&#39;: ThresholdsOutput(value=0.0, passed=True, threshold=(None, 0.1))}, proportion_ellipsis=ThresholdsOutput(value=0.0, passed=True, threshold=(None, 0.3)), proportion_bullet_points=ThresholdsOutput(value=0.0, passed=True, threshold=(None, 0.8)), contains={&#39;lorem ipsum&#39;: ThresholdsOutput(value=0.0, passed=True, threshold=False)}, duplicate_line_chr_fraction=ThresholdsOutput(value=0.26, passed=False, threshold=(None, 0.2)), duplicate_paragraph_chr_fraction=ThresholdsOutput(value=0.0, passed=True, threshold=(None, 0.2)), duplicate_ngram_chr_fraction={&#39;5&#39;: ThresholdsOutput(value=0.54, passed=False, threshold=(None, 0.15)), &#39;6&#39;: ThresholdsOutput(value=0.52, passed=False, threshold=(None, 0.14)), &#39;7&#39;: ThresholdsOutput(value=0.52, passed=False, threshold=(None, 0.13)), &#39;8&#39;: ThresholdsOutput(value=0.52, passed=False, threshold=(None, 0.12)), &#39;9&#39;: ThresholdsOutput(value=0.52, passed=False, threshold=(None, 0.11)), &#39;10&#39;: ThresholdsOutput(value=0.52, passed=False, threshold=(None, 0.1))}, top_ngram_chr_fraction={&#39;2&#39;: ThresholdsOutput(value=0.02, passed=True, threshold=(None, 0.2)), &#39;3&#39;: ThresholdsOutput(value=0.04, passed=True, threshold=(None, 0.18)), &#39;4&#39;: ThresholdsOutput(value=0.07, passed=True, threshold=(None, 0.16))})
</pre></div>
</div>
</div>
</div>
<p>Here we see that fraction of characters which is a part of a duplicate 10 gram is &gt;50%. This is a reason why the sample was filtered out. This is not uncommon for legal documents which contain a lot of standard phrases. However you might wish to change the threshold for this filter. We showed you have to do this in the previous section. We also see that the <code class="docutils literal notranslate"><span class="pre">alpha_ratio</span></code> is close 0.8. This means that the text is mostly made up of alphabetic characters. This is good, but as we will see later, this is not common for legal texts.</p>
</section>
<section id="filtering-out-the-text">
<h3>Filtering out the text<a class="headerlink" href="#filtering-out-the-text" title="Permalink to this heading">#</a></h3>
<p>Assuming we don’t want to change the filters we can now use it to filter out the texts that we want to keep:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 4. Filter out the documents that do not pass the quality</span>
<span class="n">legal_docs_filtered</span> <span class="o">=</span> <span class="p">[</span><span class="n">doc</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">legal_docs</span> <span class="k">if</span> <span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">passed_quality_check</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;We had a total of </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">legal</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2"> which we filtered down to </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">legal_docs_filtered</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>We had a total of 1000 which we filtered down to 264.
</pre></div>
</div>
</div>
</div>
<p>That seems like a lot, we should probably check why that is. We can do this by looking at the distribution of the scores of e.g. duplicate 10-gram fraction:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="k">def</span> <span class="nf">get_duplicate_10_gram_fraction</span><span class="p">(</span><span class="n">doc</span><span class="p">):</span>
    <span class="n">quality</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">quality</span>
    <span class="n">duplicate_10_gram_fraction</span> <span class="o">=</span> <span class="n">quality</span><span class="o">.</span><span class="n">duplicate_ngram_chr_fraction</span><span class="p">[</span><span class="s2">&quot;10&quot;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">duplicate_10_gram_fraction</span><span class="o">.</span><span class="n">value</span>

<span class="n">duplicate_10_gram_fraction</span> <span class="o">=</span> <span class="p">[</span><span class="n">get_duplicate_10_gram_fraction</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">legal_docs</span><span class="p">]</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">duplicate_10_gram_fraction</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot: ylabel=&#39;Count&#39;&gt;
</pre></div>
</div>
<img alt="../_images/4f1759672a8086fdbdc22579fd248bab268154b00a6343b15594156cc91e3762.png" src="../_images/4f1759672a8086fdbdc22579fd248bab268154b00a6343b15594156cc91e3762.png" />
</div>
</div>
<p>This seems like it explains a lot of the texts which were filtered out, but does not explain everything. Let us take a look at the <code class="docutils literal notranslate"><span class="pre">alpha_ratio</span></code> (the proportion of words which contains at least one alphabetic character) as well:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">alpha_ratio</span> <span class="o">=</span> <span class="p">[</span><span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">quality</span><span class="o">.</span><span class="n">alpha_ratio</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">legal_docs</span><span class="p">]</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">alpha_ratio</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot: ylabel=&#39;Count&#39;&gt;
</pre></div>
</div>
<img alt="../_images/aeb1cc3f9ff4ce17f21e177ed0c6d796ab994bd14f87aa008f7b299882d3d131.png" src="../_images/aeb1cc3f9ff4ce17f21e177ed0c6d796ab994bd14f87aa008f7b299882d3d131.png" />
</div>
</div>
<p>We see that most of the text do not pass the <code class="docutils literal notranslate"><span class="pre">alpha_ratio</span></code> threshold of 0.7 or higher. This is not uncommon for legal documents as e.g. the paragraph sign <code class="docutils literal notranslate"><span class="pre">§</span></code> is not an alphabetic character. It might be relevant to change the threshold to 0.7 or lower.</p>
</section>
<section id="comparing-across-domains">
<h3>Comparing across domains<a class="headerlink" href="#comparing-across-domains" title="Permalink to this heading">#</a></h3>
<p>We see that legal documents have quite a few perculiarities let us examine how the <code class="docutils literal notranslate"><span class="pre">alpha_ratio</span></code> behaves across different domains:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># first we apply the pipeline to the other domains</span>
<span class="n">news_docs</span> <span class="o">=</span> <span class="n">nlp</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">news</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">])</span>
<span class="n">news_docs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">news_docs</span><span class="p">)</span>
<span class="n">speech_docs</span> <span class="o">=</span> <span class="n">nlp</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">speech</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">])</span>
<span class="n">speech_docs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">speech_docs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># extract alpha ratio:</span>
<span class="n">news_alpha_ratio</span> <span class="o">=</span> <span class="p">[</span><span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">quality</span><span class="o">.</span><span class="n">alpha_ratio</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">news_docs</span><span class="p">]</span>
<span class="n">speech_alpha_ratio</span> <span class="o">=</span> <span class="p">[</span><span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">quality</span><span class="o">.</span><span class="n">alpha_ratio</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">speech_docs</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Now that we have the metrics we can plot a histogram comparing the metrics:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="c1"># histogram</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">news_alpha_ratio</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;News&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">binwidth</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">alpha_ratio</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Legal&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">binwidth</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">speech_alpha_ratio</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Speech&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">binwidth</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>

<span class="c1"># add labels</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Alpha ratio&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Count&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x29557f0d0&gt;
</pre></div>
</div>
<img alt="../_images/85958551d988fc1d83ec602c87b4083c807f8ee14aca71238031c3aad6f95091.png" src="../_images/85958551d988fc1d83ec602c87b4083c807f8ee14aca71238031c3aad6f95091.png" />
</div>
</div>
<p>Here we see a couple of things:</p>
<ul class="simple">
<li><p>A fair amount of legal documents have an alpha ratio above 0.6.</p></li>
<li><p>Almost no news text have a alpha ratio below 0.6.</p></li>
<li><p>The alpha ratio for the Speech corpus is suspicously low</p></li>
</ul>
<p>Let us examine one of the speech samples a bit more in-depth:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">doc</span> <span class="o">=</span> <span class="n">speech_docs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="c1"># examine the first 100 tokens in the first document</span>
<span class="nb">print</span><span class="p">(</span><span class="n">doc</span><span class="p">[:</span><span class="mi">100</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Taler 6: mm
Taler 7: er du klar?
Taler 6: ja
Taler 7: så er spørgsmålet om vi skal- om det er sådan her ja det kunne man godt okay
Taler 7: okay så det er ignore tab kill og kill tab
Taler 6: NA
Taler 6: kill
Taler 6: kill tab
Taler 7: super
Taler 7: okay det er det hun lige har sagt
Taler 6: ja
Taler 6: ja
Taler 6: NA
</pre></div>
</div>
</div>
</div>
<p>From this we can see that a high proportion of the tokens in the speech dataset dentoes the speaker such and tokens such as <code class="docutils literal notranslate"><span class="pre">:</span></code> then lower the alpa ratio. This might or might not be problematic for the task at hand.</p>
<p><strong>Therefore it is important to note that while these filters are useful for filtering large amount of texts it is also important to know that they should be adjusted to the target domain.</strong></p>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../news.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">News and Changelog</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="introductory_tutorial.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Introductory Tutorial</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Filtering corpora using Quality</a><ul>
<li><a class="reference internal" href="#setup">Setup</a></li>
<li><a class="reference internal" href="#filtering-web-content">Filtering Web content</a><ul>
<li><a class="reference internal" href="#the-data">The Data</a></li>
<li><a class="reference internal" href="#filtering">Filtering</a></li>
<li><a class="reference internal" href="#extracting-high-quality-texts">Extracting high quality texts</a></li>
<li><a class="reference internal" href="#changing-the-filters">Changing the filters</a></li>
</ul>
</li>
<li><a class="reference internal" href="#comparing-domains">Comparing Domains</a><ul>
<li><a class="reference internal" href="#data">Data</a></li>
<li><a class="reference internal" href="#quality-filtering">Quality Filtering</a></li>
<li><a class="reference internal" href="#filtering-out-the-text">Filtering out the text</a></li>
<li><a class="reference internal" href="#comparing-across-domains">Comparing across domains</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/scripts/furo.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/design-tabs.js"></script>
    </body>
</html>